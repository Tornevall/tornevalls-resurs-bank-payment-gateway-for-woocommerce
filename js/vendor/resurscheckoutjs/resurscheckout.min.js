/*!
 * ResursCheckoutJS v0.11
 *  Generic Resurs Bank iFrame-driver for Resurs Checkout, for catching events in the Resurs Checkout iFrame.
 *  Used for the older version of RCO-Interceptor, maintenance only!
 *  Docs and info-urls resides in the non-minified version.
 *  Maintained by Resurs Bank: onboarding@resurs.se
 *
 */
;if(typeof ResursCheckout!=="function"&&typeof ResursCheckout==="undefined"){function ResursCheckout(){var a=false;var k=false;var g="checkout";var o="";var j="";var q="0.11";var d={paymentMethod:"",customerData:{}};var h=false;var f=null;var i=null;var e=null;var c=null;var l=null;var b=null;if(typeof arguments[0]!=="undefined"){o=arguments[0]}else{o="resurs-checkout-container"}if(o.substr(0,1)==="#"){o=o.substr(1)}if(null===document.getElementById(o)&&null!==document.getElementById("omni-checkout-container")){o="omni-checkout-container";if(h){console.log("ResursCheckoutJS: [Config] Former element of Resurs Checkout is present")}}if(null!==document.getElementById(o)){b=document.getElementById(o);if(h){console.log("ResursCheckoutJS: [Config] iframe container is set to "+o)}}var n="";if(typeof RESURSCHECKOUT_IFRAME_URL!=="undefined"){n=RESURSCHECKOUT_IFRAME_URL}if(typeof OMNICHECKOUT_IFRAME_URL!=="undefined"){n=OMNICHECKOUT_IFRAME_URL}var m=function(s){var r;if(null!==b){if(h){console.log("ResursCheckoutJS: [PrePostMessage] Using resursPostMessageElement as destination")}j=b.getElementsByTagName("iframe")[0];r=j.contentWindow||j.contentDocument}else{if(h){console.log("ResursCheckoutJS: [PrePostMessage] Locating postMessage-element as resursPostMessageElement is missing")}j=document.getElementsByTagName("iframe")[0];r=j.contentWindow||j.contentDocument}if(r&&typeof r.postMessage==="function"&&typeof j.src!=="undefined"&&typeof n==="string"&&n!==""&&j.src.indexOf(n)>-1){if(h){console.log("ResursCheckoutJS: [postMessage] "+JSON.stringify(s))}r.postMessage(JSON.stringify(s),n)}else{if(h){console.log("ResursCheckoutJS: [postMessage] iframe window missing postMessage function")}}};var p={setBookingCallback:function(r){f=r},setPurchaseFailCallback:function(r){i=r},setPurchaseDeniedCallback:function(r){e=r},setCustomerChangedEventCallback:function(r){c=r},setOnIframeReady:function(r){l=r},setDebug:function(r){if(r==1){r=true}h=r;console.log("ResursCheckoutJS: [Config] Verbosity level raised")},confirmOrder:function(r){if(typeof r!=="boolean"){r=false}if(h){console.log("ResursCheckoutJS: [Outbound] Confirm order with boolean: "+r)}m({eventType:g+":order-status",orderReady:r})},postFrame:function(r){if(typeof r==="object"){if(h){console.log("ResursCheckoutJS: [Outbound] Sending message to iframe: "+JSON.stringify(r))}m(r)}},getLoadedFrame:function(){return a},isFaceliftAvailable:function(){return k},init:function(){if(typeof $ResursCheckout!=="undefined"){k=true;console.log("Discovered Resurs Bank Facelift (v2).")}window.addEventListener("message",function(u){var t=u.origin||u.originalEvent.origin;if(t!==n||typeof u.data!=="string"){return}var r=u.data;var s={};try{s=JSON.parse(r)}catch(v){return}if(s.hasOwnProperty("eventType")&&typeof s.eventType==="string"){switch(s.eventType){case g+":loaded":m({eventType:g+":set-purchase-button-interceptor",checkOrderBeforeBooking:true});a=true;if(typeof l==="function"){l(j)}break;default:if(s.eventType.indexOf(g)>-1){if(s.eventType==g+":payment-method-change"){if(h){console.log("ResursCheckoutJS: [Inbound] payment-method-change")}d.paymentMethod=s.method}else{if(s.eventType==g+":user-info-change"){if(h){console.log("ResursCheckoutJS: [Inbound] user-info-change")}d.customerData={address:(typeof s.address!=="undefined"?s.address:{}),delivery:(typeof s.delivery!=="undefined"?s.delivery:{}),ssn:s.ssn,paymentMethod:(typeof d.paymentMethod!=="undefined"?d.paymentMethod:"")};if(typeof c==="function"){c(d)}}else{if(s.eventType==g+":purchase-failed"){if(typeof i==="function"){i()}else{if(typeof i==="string"){if(typeof window[i]==="function"){window[i]()}}}}else{if(s.eventType==g+":purchase-denied"){if(typeof e==="function"){e()}else{if(typeof e==="string"){if(typeof window[e]==="function"){window[e]()}}}}else{if(s.eventType==g+":puchase-button-clicked"){if(typeof f==="function"){if(h){console.log("ResursCheckoutJS: [Outbound] puchase-button-clicked event received, bounce back through user defined callback.")}f(d,s)}else{if(typeof f==="string"){if(typeof window[f]==="function"){window[f](d,s)}}else{if(h){console.log("ResursCheckoutJS: [Outbound] puchase-button-clicked event received and no user defined callbacks was found. Cosidering autoConfirm.")}m({eventType:g+":order-status",orderReady:true})}}}}}}}}}}},false)}};return p}};
